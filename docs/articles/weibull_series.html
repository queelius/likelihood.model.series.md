<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Heterogeneous Weibull Series Systems: Flexible Hazard Shapes • likelihood.model.series.md</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Heterogeneous Weibull Series Systems: Flexible Hazard Shapes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">likelihood.model.series.md</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/queelius/likelihood.model.series.md/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Heterogeneous Weibull Series Systems: Flexible Hazard Shapes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/queelius/likelihood.model.series.md/blob/HEAD/vignettes/weibull_series.Rmd" class="external-link"><code>vignettes/weibull_series.Rmd</code></a></small>
      <div class="d-none name"><code>weibull_series.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>Real engineered systems are composed of components with fundamentally
different failure mechanisms. Consider a pumping station with three
subsystems:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Electronic controller</strong> – dominated by early-life
defects (solder joints, capacitor infant mortality). The hazard rate
<em>decreases</em> over time as weak units are weeded out. This is a
decreasing failure rate (DFR), modeled by a Weibull shape
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k &lt; 1</annotation></semantics></math>.</p></li>
<li><p><strong>Seals and gaskets</strong> – random shocks and chemical
degradation produce failures at a roughly constant rate over the
component’s useful life. This is a constant failure rate (CFR),
corresponding to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k = 1</annotation></semantics></math>
(exponential).</p></li>
<li><p><strong>Mechanical bearing</strong> – progressive wear-out causes
the hazard rate to <em>increase</em> over time. This is an increasing
failure rate (IFR), modeled by a Weibull shape
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k &gt; 1</annotation></semantics></math>.</p></li>
</ol>
<p>The exponential series model forces
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k_j = 1</annotation></semantics></math>
for every component, collapsing all three mechanisms into a single
constant-hazard regime. The homogeneous Weibull model
(<code>wei_series_homogeneous_md_c1_c2_c3</code>) allows
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>≠</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k \neq 1</annotation></semantics></math>
but constrains all components to share a common shape — still too
restrictive when failure physics differ across subsystems.</p>
<p>The <strong>heterogeneous Weibull series model</strong>
(<code>wei_series_md_c1_c2_c3</code>) removes this constraint entirely.
Each of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
components has its own shape and scale:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>∼</mo><mo>Weibull</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>k</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>m</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">
T_{ij} \sim \operatorname{Weibull}(k_j, \beta_j), \quad j = 1, \ldots, m,
</annotation></semantics></math> giving a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>m</mi></mrow><annotation encoding="application/x-tex">2m</annotation></semantics></math>-dimensional
parameter vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo>,</mo><msub><mi>β</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>k</mi><mi>m</mi></msub><mo>,</mo><msub><mi>β</mi><mi>m</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta = (k_1, \beta_1, \ldots, k_m, \beta_m)</annotation></semantics></math>.</p>
<p>When all shapes are equal
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mn>1</mn></msub><mo>=</mo><mi>⋯</mi><mo>=</mo><msub><mi>k</mi><mi>m</mi></msub><mo>=</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">k_1 = \cdots = k_m = k</annotation></semantics></math>),
this model reduces to the homogeneous case, making the heterogeneous
model a strict generalization.</p>
<p>The additional flexibility comes at a cost: the system lifetime
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>=</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>T</mi><mi>m</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">T = \min(T_1, \ldots, T_m)</annotation></semantics></math>
is no longer Weibull-distributed when the shapes differ, and
left-censored or interval-censored likelihood contributions require
numerical integration rather than closed-form expressions.</p>
<p>This vignette demonstrates the full workflow: hazard profiling, data
generation, MLE under mixed censoring, model comparison, and Monte Carlo
assessment of estimator properties.</p>
</div>
<div class="section level2">
<h2 id="component-hazard-and-cause-probability-profiles">Component hazard and cause probability profiles<a class="anchor" aria-label="anchor" href="#component-hazard-and-cause-probability-profiles"></a>
</h2>
<p>We begin with a 3-component system that illustrates all three hazard
regimes. The true parameters are:</p>
<table class="table">
<thead><tr class="header">
<th>Component</th>
<th>Type</th>
<th align="center">Shape
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>k</mi><mi>j</mi></msub><annotation encoding="application/x-tex">k_j</annotation></semantics></math>
</th>
<th align="center">Scale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\beta_j</annotation></semantics></math>
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1 (electronics)</td>
<td>DFR</td>
<td align="center">0.7</td>
<td align="center">200</td>
</tr>
<tr class="even">
<td>2 (seals)</td>
<td>CFR</td>
<td align="center">1.0</td>
<td align="center">150</td>
</tr>
<tr class="odd">
<td>3 (bearing)</td>
<td>IFR</td>
<td align="center">2.0</td>
<td align="center">100</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">200</span>,   <span class="co"># component 1: DFR (electronics)</span></span>
<span>           <span class="fl">1.0</span>, <span class="fl">150</span>,   <span class="co"># component 2: CFR (seals)</span></span>
<span>           <span class="fl">2.0</span>, <span class="fl">100</span><span class="op">)</span>   <span class="co"># component 3: IFR (bearing)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span></code></pre></div>
<div class="section level3">
<h3 id="hazard-functions">Hazard functions<a class="anchor" aria-label="anchor" href="#hazard-functions"></a>
</h3>
<p>The Weibull hazard for component
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>;</mo><msub><mi>k</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><msub><mi>k</mi><mi>j</mi></msub><msub><mi>β</mi><mi>j</mi></msub></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>t</mi><msub><mi>β</mi><mi>j</mi></msub></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><msub><mi>k</mi><mi>j</mi></msub><mo>−</mo><mn>1</mn></mrow></msup><mo>,</mo><mspace width="1.0em"></mspace><mi>t</mi><mo>&gt;</mo><mn>0</mn><mi>.</mi></mrow><annotation encoding="application/x-tex">
h_j(t; k_j, \beta_j) = \frac{k_j}{\beta_j}
  \left(\frac{t}{\beta_j}\right)^{k_j - 1}, \quad t &gt; 0.
</annotation></semantics></math></p>
<p>We extract component hazard closures from the model object and plot
them:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wei_series_md_c1_c2_c3.html">wei_series_md_c1_c2_c3</a></span><span class="op">(</span></span>
<span>  shapes <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  scales <span class="op">=</span> <span class="va">theta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">h1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/component_hazard.html">component_hazard</a></span><span class="op">(</span><span class="va">model</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">h2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/component_hazard.html">component_hazard</a></span><span class="op">(</span><span class="va">model</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">h3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/component_hazard.html">component_hazard</a></span><span class="op">(</span><span class="va">model</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">120</span>, length.out <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t_grid</span>, <span class="fu">h1</span><span class="op">(</span><span class="va">t_grid</span>, <span class="va">theta</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Hazard rate h(t)"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Component hazard functions"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">t_grid</span>, <span class="fu">h2</span><span class="op">(</span><span class="va">t_grid</span>, <span class="va">theta</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"forestgreen"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">t_grid</span>, <span class="fu">h3</span><span class="op">(</span><span class="va">t_grid</span>, <span class="va">theta</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"firebrick"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Comp 1: DFR (k=0.7)"</span>, <span class="st">"Comp 2: CFR (k=1.0)"</span>,</span>
<span>                  <span class="st">"Comp 3: IFR (k=2.0)"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"steelblue"</span>, <span class="st">"forestgreen"</span>, <span class="st">"firebrick"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="weibull_series_files/figure-html/hazard-plot-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
<p>The DFR component (blue) has a hazard that starts high and decays –
typical of infant-mortality failures. The CFR component (green) is flat,
consistent with random shocks. The IFR component (red) rises steadily,
reflecting wear-out. The system hazard
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mo>∑</mo><mi>j</mi></msub><msub><mi>h</mi><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t) = \sum_j h_j(t)</annotation></semantics></math>
is the vertical sum of these curves.</p>
</div>
<div class="section level3">
<h3 id="conditional-cause-probability">Conditional cause probability<a class="anchor" aria-label="anchor" href="#conditional-cause-probability"></a>
</h3>
<p>The probability that component
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
caused the system failure, conditional on failure at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo>=</mo><mi>j</mi><mo>∣</mo><mi>T</mi><mo>=</mo><mi>t</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><msub><mi>h</mi><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><munderover><mo>∑</mo><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><msub><mi>h</mi><mi>l</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>;</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
P(K = j \mid T = t, \theta) = \frac{h_j(t; \theta)}{\sum_{l=1}^m h_l(t; \theta)}.
</annotation></semantics></math></p>
<p>This is the key quantity for diagnosing which failure mode dominates
at different points in the system’s life:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ccp_fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conditional_cause_probability.html">conditional_cause_probability</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">ccp_fn</span><span class="op">(</span><span class="va">t_grid</span>, <span class="va">theta</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t_grid</span>, <span class="va">probs</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"P(K = j | T = t)"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Conditional cause-of-failure probability"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">t_grid</span>, <span class="va">probs</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"forestgreen"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">t_grid</span>, <span class="va">probs</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"firebrick"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"right"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Comp 1: DFR"</span>, <span class="st">"Comp 2: CFR"</span>, <span class="st">"Comp 3: IFR"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"steelblue"</span>, <span class="st">"forestgreen"</span>, <span class="st">"firebrick"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="weibull_series_files/figure-html/cause-prob-plot-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
<p>At early times the DFR component dominates because its hazard is
highest when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is small. As time progresses the IFR component takes over, eventually
accounting for the majority of failures. The CFR component contributes a
roughly constant share. This crossover pattern is characteristic of
bathtub-curve behavior at the system level and cannot be captured by
models that force a common shape parameter.</p>
</div>
</div>
<div class="section level2">
<h2 id="numerical-integration-for-left-and-interval-censoring">Numerical integration for left and interval censoring<a class="anchor" aria-label="anchor" href="#numerical-integration-for-left-and-interval-censoring"></a>
</h2>
<div class="section level3">
<h3 id="why-numerical-integration-is-necessary">Why numerical integration is necessary<a class="anchor" aria-label="anchor" href="#why-numerical-integration-is-necessary"></a>
</h3>
<p>For <strong>exact</strong> and <strong>right-censored</strong>
observations, the Weibull log-likelihood contribution has a closed form
regardless of whether shapes are heterogeneous:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">Exact:</mtext><mspace width="1.0em"></mspace></mtd><mtd columnalign="left" style="text-align: left"><mo>log</mo><munder><mo>∑</mo><mrow><mi>j</mi><mo>∈</mo><msub><mi>c</mi><mi>i</mi></msub></mrow></munder><msub><mi>h</mi><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><munderover><mo>∑</mo><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><msub><mi>H</mi><mi>l</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">Right:</mtext><mspace width="1.0em"></mspace></mtd><mtd columnalign="left" style="text-align: left"><mo>−</mo><munderover><mo>∑</mo><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><msub><mi>H</mi><mi>l</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
\text{Exact:} \quad &amp; \log \sum_{j \in c_i} h_j(t_i) - \sum_{l=1}^m H_l(t_i), \\
\text{Right:} \quad &amp; -\sum_{l=1}^m H_l(t_i),
\end{align}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>l</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mi>/</mi><msub><mi>β</mi><mi>l</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>k</mi><mi>l</mi></msub></msup></mrow><annotation encoding="application/x-tex">H_l(t) = (t/\beta_l)^{k_l}</annotation></semantics></math>
is the cumulative hazard of component
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>.</p>
<p>For <strong>left-censored</strong> and
<strong>interval-censored</strong> observations, the contribution
involves integrating the “candidate-weighted” density over an interval:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>ℓ</mo><mi>i</mi></msub><mo>=</mo><mo>log</mo><msubsup><mo>∫</mo><mi>a</mi><mi>b</mi></msubsup><mrow><mo stretchy="true" form="prefix">[</mo><munder><mo>∑</mo><mrow><mi>j</mi><mo>∈</mo><msub><mi>c</mi><mi>i</mi></msub></mrow></munder><msub><mi>h</mi><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>exp</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><munderover><mo>∑</mo><mrow><mi>l</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><msub><mi>H</mi><mi>l</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>u</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">
\ell_i = \log \int_a^b \left[\sum_{j \in c_i} h_j(u)\right]
  \exp\!\left(-\sum_{l=1}^m H_l(u)\right) du.
</annotation></semantics></math></p>
<p>When all shapes are equal
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>l</mi></msub><mo>=</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">k_l = k</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>),
the candidate weight
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>c</mi></msub><mo>=</mo><msub><mo>∑</mo><mrow><mi>j</mi><mo>∈</mo><mi>c</mi></mrow></msub><msubsup><mi>β</mi><mi>j</mi><mrow><mo>−</mo><mi>k</mi></mrow></msubsup><mi>/</mi><msub><mo>∑</mo><mi>l</mi></msub><msubsup><mi>β</mi><mi>l</mi><mrow><mo>−</mo><mi>k</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">w_c = \sum_{j \in c} \beta_j^{-k} / \sum_l \beta_l^{-k}</annotation></semantics></math>
factors out of the integral, leaving a standard Weibull CDF difference
that has a closed form. This is the <code>w_c</code> factorization that
the homogeneous model exploits.</p>
<p>When shapes differ, no such factorization exists, and
<code><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">stats::integrate</a></code> is used internally. The integrand is
accessible (for advanced use) via
<code>likelihood.model.series.md:::wei_series_integrand</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shapes</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">scales</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">cind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># candidate set = {1, 2}</span></span>
<span></span>
<span><span class="co"># Evaluate the integrand h_c(t) * S(t) at a few time points</span></span>
<span><span class="va">t_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu">likelihood.model.series.md</span><span class="fu">:::</span><span class="fu"><a href="../reference/wei_series_integrand.html">wei_series_integrand</a></span><span class="op">(</span></span>
<span>  <span class="va">t_eval</span>, <span class="va">shapes</span>, <span class="va">scales</span>, <span class="va">cind</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t="</span>, <span class="va">t_eval</span><span class="op">)</span></span>
<span><span class="va">vals</span></span>
<span><span class="co">#&gt;     t=10     t=50    t=100 </span></span>
<span><span class="co">#&gt; 0.012504 0.004574 0.001120</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_fine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">150</span>, length.out <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Full candidate set: all components</span></span>
<span><span class="va">vals_full</span> <span class="op">&lt;-</span> <span class="fu">likelihood.model.series.md</span><span class="fu">:::</span><span class="fu"><a href="../reference/wei_series_integrand.html">wei_series_integrand</a></span><span class="op">(</span></span>
<span>  <span class="va">t_fine</span>, <span class="va">shapes</span>, <span class="va">scales</span>, cind <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t_fine</span>, <span class="va">vals_full</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">h</span><span class="op">[</span><span class="va">c</span><span class="op">]</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">%.%</span> <span class="fu">S</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Weibull series integrand (full candidate set)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="weibull_series_files/figure-html/integrand-plot-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
<p>The integrand is the product of the candidate hazard sum and the
system survival function. Its integral over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(0, \tau)</annotation></semantics></math>
gives the probability that the system fails before
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
with the cause in the candidate set.</p>
</div>
<div class="section level3">
<h3 id="timing-comparison">Timing comparison<a class="anchor" aria-label="anchor" href="#timing-comparison"></a>
</h3>
<p>Numerical integration adds per-observation cost. We compare
log-likelihood evaluation time for exact-only versus mixed-censoring
data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">gen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://queelius.github.io/likelihood.model/reference/rdata.html" class="external-link">rdata</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">ll_fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://queelius.github.io/likelihood.model/reference/loglik.html" class="external-link">loglik</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exact + right only</span></span>
<span><span class="va">df_exact</span> <span class="op">&lt;-</span> <span class="fu">gen</span><span class="op">(</span><span class="va">theta</span>, n <span class="op">=</span> <span class="fl">100</span>, tau <span class="op">=</span> <span class="fl">120</span>, p <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                observe <span class="op">=</span> <span class="fu"><a href="../reference/observe_right_censor.html">observe_right_censor</a></span><span class="op">(</span>tau <span class="op">=</span> <span class="fl">120</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mixed: includes left and interval censoring</span></span>
<span><span class="va">df_mixed</span> <span class="op">&lt;-</span> <span class="fu">gen</span><span class="op">(</span><span class="va">theta</span>, n <span class="op">=</span> <span class="fl">100</span>, p <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                observe <span class="op">=</span> <span class="fu"><a href="../reference/observe_mixture.html">observe_mixture</a></span><span class="op">(</span></span>
<span>                  <span class="fu"><a href="../reference/observe_right_censor.html">observe_right_censor</a></span><span class="op">(</span>tau <span class="op">=</span> <span class="fl">120</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="../reference/observe_left_censor.html">observe_left_censor</a></span><span class="op">(</span>tau <span class="op">=</span> <span class="fl">80</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="../reference/observe_periodic.html">observe_periodic</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fl">20</span>, tau <span class="op">=</span> <span class="fl">120</span><span class="op">)</span>,</span>
<span>                  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span></span>
<span>                <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Observation type counts (exact/right):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Observation type counts (exact/right):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df_exact</span><span class="op">$</span><span class="va">omega</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exact right </span></span>
<span><span class="co">#&gt;    97     3</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nObservation type counts (mixed):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Observation type counts (mixed):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df_mixed</span><span class="op">$</span><span class="va">omega</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    exact interval     left    right </span></span>
<span><span class="co">#&gt;       47       31       13        9</span></span>
<span></span>
<span><span class="va">t_exact</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu">ll_fn</span><span class="op">(</span><span class="va">df_exact</span>, <span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span></span>
<span><span class="va">t_mixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu">ll_fn</span><span class="op">(</span><span class="va">df_mixed</span>, <span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nLoglik time (exact/right only): %.4f s per eval\n"</span>, <span class="va">t_exact</span> <span class="op">/</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Loglik time (exact/right only): 0.0012 s per eval</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Loglik time (mixed censoring):  %.4f s per eval\n"</span>, <span class="va">t_mixed</span> <span class="op">/</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loglik time (mixed censoring):  0.0344 s per eval</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Slowdown factor: %.1fx\n"</span>, <span class="va">t_mixed</span> <span class="op">/</span> <span class="va">t_exact</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Slowdown factor: 28.7x</span></span></code></pre></div>
<p>The slowdown is proportional to the number of left/interval
observations, since each requires a call to
<code><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">stats::integrate</a></code>. For moderate sample sizes this is fast
enough for iterative optimization.</p>
</div>
</div>
<div class="section level2">
<h2 id="mle-with-mixed-censoring">MLE with mixed censoring<a class="anchor" aria-label="anchor" href="#mle-with-mixed-censoring"></a>
</h2>
<p>We now demonstrate the full estimation workflow: generate data under
a mixed observation scheme, then fit the heterogeneous Weibull
model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7231</span><span class="op">)</span></span>
<span><span class="va">n_mle</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span></span>
<span><span class="co"># Right-censoring only (fast, closed-form likelihood)</span></span>
<span><span class="va">gen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://queelius.github.io/likelihood.model/reference/rdata.html" class="external-link">rdata</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">gen</span><span class="op">(</span><span class="va">theta</span>, n <span class="op">=</span> <span class="va">n_mle</span>, tau <span class="op">=</span> <span class="fl">120</span>, p <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>          observe <span class="op">=</span> <span class="fu"><a href="../reference/observe_right_censor.html">observe_right_censor</a></span><span class="op">(</span>tau <span class="op">=</span> <span class="fl">120</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Observation types:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Observation types:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">omega</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exact right </span></span>
<span><span class="co">#&gt;   286    14</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nFirst few rows:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First few rows:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         t omega    x1    x2    x3</span></span>
<span><span class="co">#&gt;   43.5375 exact  TRUE  TRUE  TRUE</span></span>
<span><span class="co">#&gt;  120.0000 right FALSE FALSE FALSE</span></span>
<span><span class="co">#&gt;  109.3242 exact FALSE FALSE  TRUE</span></span>
<span><span class="co">#&gt;  106.2039 exact FALSE FALSE  TRUE</span></span>
<span><span class="co">#&gt;   56.8859 exact FALSE  TRUE  TRUE</span></span>
<span><span class="co">#&gt;    0.5781 exact  TRUE  TRUE FALSE</span></span></code></pre></div>
<p>We use right-censoring here because exact and right-censored
observations have closed-form likelihood contributions, making
optimization fast. Left-censored and interval-censored observations
require numerical integration per observation per iteration (see Section
5), so MLE with many such observations is substantially slower. In
practice, the <code><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit()</a></code> interface is the same regardless of
observation type – only the wall-clock time differs.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">solver</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initial guess: all shapes = 1, scales = 100</span></span>
<span><span class="va">theta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span>, <span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="va">estimate</span> <span class="op">&lt;-</span> <span class="fu">solver</span><span class="op">(</span><span class="va">df</span>, par <span class="op">=</span> <span class="va">theta0</span>, method <span class="op">=</span> <span class="st">"Nelder-Mead"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span><span class="co">#&gt; Maximum Likelihood Estimate (Fisherian)</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; [1]   0.6864 200.8685   1.1214 154.3711   2.3123 100.1984</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Log-likelihood: -1572 </span></span>
<span><span class="co">#&gt; Observations: 300 </span></span>
<span><span class="co">#&gt; WARNING: Optimization did not converge</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parameter recovery table</span></span>
<span><span class="va">par_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"k"</span>, <span class="st">"beta"</span><span class="op">)</span>, <span class="va">m</span><span class="op">)</span>, <span class="st">"_"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">m</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">recovery</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Parameter <span class="op">=</span> <span class="va">par_names</span>,</span>
<span>  True <span class="op">=</span> <span class="va">theta</span>,</span>
<span>  Estimate <span class="op">=</span> <span class="va">estimate</span><span class="op">$</span><span class="va">par</span>,</span>
<span>  SE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">$</span><span class="va">vcov</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Rel_Error_Pct <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">estimate</span><span class="op">$</span><span class="va">par</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span> <span class="op">/</span> <span class="va">theta</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">recovery</span>, digits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>             caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Parameter recovery (n = "</span>, <span class="va">n_mle</span>, <span class="st">")"</span><span class="op">)</span>,</span>
<span>             col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Parameter"</span>, <span class="st">"True"</span>, <span class="st">"MLE"</span>, <span class="st">"SE"</span>, <span class="st">"Rel. Error %"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Parameter recovery (n = 300)</caption>
<thead><tr class="header">
<th align="left">Parameter</th>
<th align="right">True</th>
<th align="right">MLE</th>
<th align="right">SE</th>
<th align="right">Rel. Error %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">k_1</td>
<td align="right">0.7</td>
<td align="right">0.686</td>
<td align="right">0.066</td>
<td align="right">-1.940</td>
</tr>
<tr class="even">
<td align="left">beta_1</td>
<td align="right">200.0</td>
<td align="right">200.868</td>
<td align="right">42.485</td>
<td align="right">0.434</td>
</tr>
<tr class="odd">
<td align="left">k_2</td>
<td align="right">1.0</td>
<td align="right">1.121</td>
<td align="right">0.128</td>
<td align="right">12.136</td>
</tr>
<tr class="even">
<td align="left">beta_2</td>
<td align="right">150.0</td>
<td align="right">154.371</td>
<td align="right">23.838</td>
<td align="right">2.914</td>
</tr>
<tr class="odd">
<td align="left">k_3</td>
<td align="right">2.0</td>
<td align="right">2.312</td>
<td align="right">0.213</td>
<td align="right">15.616</td>
</tr>
<tr class="even">
<td align="left">beta_3</td>
<td align="right">100.0</td>
<td align="right">100.198</td>
<td align="right">5.201</td>
<td align="right">0.198</td>
</tr>
</tbody>
</table>
<p>With
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>300</mn></mrow><annotation encoding="application/x-tex">n = 300</annotation></semantics></math>
observations and substantial masking
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0.3</mn></mrow><annotation encoding="application/x-tex">p = 0.3</annotation></semantics></math>),
the MLE recovers all six parameters. Shape parameters are typically
estimated with higher relative error than scales, which is expected:
shape controls the curvature of the hazard, and distinguishing curvature
from level requires more information than estimating the level
alone.</p>
</div>
<div class="section level2">
<h2 id="model-comparison-heterogeneous-vs-homogeneous">Model comparison: heterogeneous vs homogeneous<a class="anchor" aria-label="anchor" href="#model-comparison-heterogeneous-vs-homogeneous"></a>
</h2>
<p>A central question in practice is whether the added complexity of
heterogeneous shapes is justified by the data. We compare the
heterogeneous model (6 parameters) against the homogeneous model (4
parameters: one common shape plus three scales).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">999</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate from the TRUE heterogeneous DGP</span></span>
<span><span class="va">df_comp</span> <span class="op">&lt;-</span> <span class="fu">gen</span><span class="op">(</span><span class="va">theta</span>, n <span class="op">=</span> <span class="fl">800</span>, tau <span class="op">=</span> <span class="fl">150</span>, p <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>               observe <span class="op">=</span> <span class="fu"><a href="../reference/observe_right_censor.html">observe_right_censor</a></span><span class="op">(</span>tau <span class="op">=</span> <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Observation types:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Observation types:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df_comp</span><span class="op">$</span><span class="va">omega</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; exact right </span></span>
<span><span class="co">#&gt;   790    10</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit heterogeneous model (6 parameters)</span></span>
<span><span class="va">model_het</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wei_series_md_c1_c2_c3.html">wei_series_md_c1_c2_c3</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">solver_het</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">model_het</span><span class="op">)</span></span>
<span><span class="va">fit_het</span> <span class="op">&lt;-</span> <span class="fu">solver_het</span><span class="op">(</span><span class="va">df_comp</span>, par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">120</span><span class="op">)</span>, <span class="va">m</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"Nelder-Mead"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit homogeneous model (4 parameters)</span></span>
<span><span class="va">model_hom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wei_series_homogeneous_md_c1_c2_c3.html">wei_series_homogeneous_md_c1_c2_c3</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">solver_hom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">model_hom</span><span class="op">)</span></span>
<span><span class="va">theta0_hom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">120</span>, <span class="fl">120</span>, <span class="fl">120</span><span class="op">)</span></span>
<span><span class="va">fit_hom</span> <span class="op">&lt;-</span> <span class="fu">solver_hom</span><span class="op">(</span><span class="va">df_comp</span>, par <span class="op">=</span> <span class="va">theta0_hom</span>, method <span class="op">=</span> <span class="st">"Nelder-Mead"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Heterogeneous model (2m = 6 params):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Heterogeneous model (2m = 6 params):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Log-likelihood:"</span>, <span class="va">fit_het</span><span class="op">$</span><span class="va">loglik</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Log-likelihood: -4375</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Parameters:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_het</span><span class="op">$</span><span class="va">par</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Parameters: 0.85 133.2 0.93 170.5 2.22 96.6</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Homogeneous model (m+1 = 4 params):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Homogeneous model (m+1 = 4 params):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Log-likelihood:"</span>, <span class="va">fit_hom</span><span class="op">$</span><span class="va">loglik</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Log-likelihood: -4451</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Parameters:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_hom</span><span class="op">$</span><span class="va">par</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Parameters: 1.11 128 151.9 112.7</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Likelihood ratio test</span></span>
<span><span class="co"># H0: k1 = k2 = k3 (homogeneous, 4 params)</span></span>
<span><span class="co"># H1: k1, k2, k3 free (heterogeneous, 6 params)</span></span>
<span><span class="va">LRT</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">fit_het</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">fit_hom</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span></span>
<span><span class="va">df_lrt</span> <span class="op">&lt;-</span> <span class="fl">6</span> <span class="op">-</span> <span class="fl">4</span>  <span class="co"># difference in parameters</span></span>
<span><span class="va">p_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">pchisq</a></span><span class="op">(</span><span class="va">LRT</span>, df <span class="op">=</span> <span class="va">df_lrt</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Heterogeneous (2m)"</span>, <span class="st">"Homogeneous (m+1)"</span><span class="op">)</span>,</span>
<span>  Params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  LogLik <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_het</span><span class="op">$</span><span class="va">loglik</span>, <span class="va">fit_hom</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span>,</span>
<span>  AIC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">fit_het</span><span class="op">$</span><span class="va">loglik</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">6</span>, <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="va">fit_hom</span><span class="op">$</span><span class="va">loglik</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">comparison</span>, digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             caption <span class="op">=</span> <span class="st">"Model comparison: heterogeneous vs homogeneous"</span>,</span>
<span>             col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Model"</span>, <span class="st">"# Params"</span>, <span class="st">"Log-Lik"</span>, <span class="st">"AIC"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Model comparison: heterogeneous vs homogeneous</caption>
<thead><tr class="header">
<th align="left">Model</th>
<th align="right"># Params</th>
<th align="right">Log-Lik</th>
<th align="right">AIC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Heterogeneous (2m)</td>
<td align="right">6</td>
<td align="right">-4375</td>
<td align="right">8763</td>
</tr>
<tr class="even">
<td align="left">Homogeneous (m+1)</td>
<td align="right">4</td>
<td align="right">-4451</td>
<td align="right">8911</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nLikelihood ratio statistic: %.2f (df = %d, p = %.4f)\n"</span>,</span>
<span>            <span class="va">LRT</span>, <span class="va">df_lrt</span>, <span class="va">p_value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio statistic: 151.83 (df = 2, p = 0.0000)</span></span></code></pre></div>
<p>When the true DGP has heterogeneous shapes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.7</mn><mo>,</mo><mn>1.0</mn><mo>,</mo><mn>2.0</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(0.7, 1.0, 2.0)</annotation></semantics></math>,
the homogeneous model is misspecified. The likelihood ratio test and AIC
both strongly favor the heterogeneous model. The common shape estimate
from the homogeneous fit represents a compromise value between the true
shapes, leading to biased estimates of the scale parameters as well.</p>
<p><strong>Bias-variance tradeoff.</strong> When sample sizes are small
or censoring is heavy, the homogeneous model may still be preferable
despite misspecification: its fewer parameters yield lower variance
estimates. In such regimes, the MSE of the homogeneous estimator can be
smaller than that of the heterogeneous estimator, even though the latter
is unbiased. As
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
grows, the bias of the homogeneous model becomes the dominant error
term, and the heterogeneous model wins.</p>
</div>
<div class="section level2">
<h2 id="monte-carlo-study">Monte Carlo study<a class="anchor" aria-label="anchor" href="#monte-carlo-study"></a>
</h2>
<p>We assess the finite-sample properties of the MLE for the
heterogeneous Weibull model through a Monte Carlo simulation.</p>
<p><strong>Design:</strong></p>
<ul>
<li>True DGP:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.8</mn><mo>,</mo><mn>150</mn><mo>,</mo><mn>1.5</mn><mo>,</mo><mn>120</mn><mo>,</mo><mn>2.0</mn><mo>,</mo><mn>100</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta = (0.8, 150, 1.5, 120, 2.0, 100)</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">m = 3</annotation></semantics></math>
components and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>m</mi><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">2m = 6</annotation></semantics></math>
parameters.</li>
<li>Sample size:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">n = 1000</annotation></semantics></math>.</li>
<li>Replications:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">B = 100</annotation></semantics></math>.</li>
<li>Masking probability:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">p = 0.2</annotation></semantics></math>.</li>
<li>Right-censoring at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">\tau = 200</annotation></semantics></math>.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">theta_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">150</span>, <span class="fl">1.5</span>, <span class="fl">120</span>, <span class="fl">2.0</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">m_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">theta_mc</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="va">n_mc</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">p_mc</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span><span class="va">tau_mc</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span></span>
<span><span class="va">model_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wei_series_md_c1_c2_c3.html">wei_series_md_c1_c2_c3</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gen_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://queelius.github.io/likelihood.model/reference/rdata.html" class="external-link">rdata</a></span><span class="op">(</span><span class="va">model_mc</span><span class="op">)</span></span>
<span><span class="va">solver_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">model_mc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Storage</span></span>
<span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">B</span>, ncol <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">m_mc</span><span class="op">)</span></span>
<span><span class="va">se_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">B</span>, ncol <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">m_mc</span><span class="op">)</span></span>
<span><span class="va">ci_lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">B</span>, ncol <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">m_mc</span><span class="op">)</span></span>
<span><span class="va">ci_upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">B</span>, ncol <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">m_mc</span><span class="op">)</span></span>
<span><span class="va">converged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span>
<span><span class="va">logliks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta0_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">130</span><span class="op">)</span>, <span class="va">m_mc</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_b</span> <span class="op">&lt;-</span> <span class="fu">gen_mc</span><span class="op">(</span><span class="va">theta_mc</span>, n <span class="op">=</span> <span class="va">n_mc</span>, tau <span class="op">=</span> <span class="va">tau_mc</span>, p <span class="op">=</span> <span class="va">p_mc</span>,</span>
<span>                 observe <span class="op">=</span> <span class="fu"><a href="../reference/observe_right_censor.html">observe_right_censor</a></span><span class="op">(</span>tau <span class="op">=</span> <span class="va">tau_mc</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">fit_b</span> <span class="op">&lt;-</span> <span class="fu">solver_mc</span><span class="op">(</span><span class="va">df_b</span>, par <span class="op">=</span> <span class="va">theta0_mc</span>,</span>
<span>                       method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>                       lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1e-6</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">m_mc</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">estimates</span><span class="op">[</span><span class="va">b</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit_b</span><span class="op">$</span><span class="va">par</span></span>
<span>    <span class="va">se_estimates</span><span class="op">[</span><span class="va">b</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">fit_b</span><span class="op">$</span><span class="va">vcov</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">logliks</span><span class="op">[</span><span class="va">b</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit_b</span><span class="op">$</span><span class="va">loglik</span></span>
<span></span>
<span>    <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">ci_lower</span><span class="op">[</span><span class="va">b</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit_b</span><span class="op">$</span><span class="va">par</span> <span class="op">-</span> <span class="va">z</span> <span class="op">*</span> <span class="va">se_estimates</span><span class="op">[</span><span class="va">b</span>, <span class="op">]</span></span>
<span>    <span class="va">ci_upper</span><span class="op">[</span><span class="va">b</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit_b</span><span class="op">$</span><span class="va">par</span> <span class="op">+</span> <span class="va">z</span> <span class="op">*</span> <span class="va">se_estimates</span><span class="op">[</span><span class="va">b</span>, <span class="op">]</span></span>
<span>    <span class="va">converged</span><span class="op">[</span><span class="va">b</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit_b</span><span class="op">$</span><span class="va">converged</span></span>
<span>  <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">converged</span><span class="op">[</span><span class="va">b</span><span class="op">]</span> <span class="op">&lt;&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">b</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">20</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Replication %d/%d\n"</span>, <span class="va">b</span>, <span class="va">B</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Convergence rate:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">converged</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="bias-variance-and-mse">Bias, variance, and MSE<a class="anchor" aria-label="anchor" href="#bias-variance-and-mse"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta_mc</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">theta_mc</span></span>
<span><span class="va">m_mc</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">m_mc</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">alpha</span></span>
<span></span>
<span><span class="va">valid</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">converged</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">estimates</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">est_valid</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">estimates</span><span class="op">[</span><span class="va">valid</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span><span class="va">bias</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">est_valid</span><span class="op">)</span> <span class="op">-</span> <span class="va">theta_mc</span></span>
<span><span class="va">variance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">est_valid</span>, <span class="fl">2</span>, <span class="va">var</span><span class="op">)</span></span>
<span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="va">bias</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">variance</span></span>
<span><span class="va">rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span></span>
<span></span>
<span><span class="va">par_names_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"k"</span>, <span class="st">"beta"</span><span class="op">)</span>, <span class="va">m_mc</span><span class="op">)</span>, <span class="st">"_"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">m_mc</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Parameter <span class="op">=</span> <span class="va">par_names_mc</span>,</span>
<span>  True <span class="op">=</span> <span class="va">theta_mc</span>,</span>
<span>  Mean_Est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">est_valid</span><span class="op">)</span>,</span>
<span>  Bias <span class="op">=</span> <span class="va">bias</span>,</span>
<span>  Variance <span class="op">=</span> <span class="va">variance</span>,</span>
<span>  MSE <span class="op">=</span> <span class="va">mse</span>,</span>
<span>  RMSE <span class="op">=</span> <span class="va">rmse</span>,</span>
<span>  Rel_Bias_Pct <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">bias</span> <span class="op">/</span> <span class="va">theta_mc</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">results_df</span>, digits <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Monte Carlo results (n = "</span>, <span class="va">results</span><span class="op">$</span><span class="va">n_mc</span>,</span>
<span>                              <span class="st">", B = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">valid</span><span class="op">)</span>, <span class="st">" converged)"</span><span class="op">)</span>,</span>
<span>             col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Parameter"</span>, <span class="st">"True"</span>, <span class="st">"Mean Est."</span>,</span>
<span>                          <span class="st">"Bias"</span>, <span class="st">"Variance"</span>, <span class="st">"MSE"</span>, <span class="st">"RMSE"</span>,</span>
<span>                          <span class="st">"Rel. Bias %"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Monte Carlo results (n = 1000, B = 82 converged)</caption>
<colgroup>
<col width="13%">
<col width="8%">
<col width="13%">
<col width="11%">
<col width="12%">
<col width="12%">
<col width="11%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">Parameter</th>
<th align="right">True</th>
<th align="right">Mean Est.</th>
<th align="right">Bias</th>
<th align="right">Variance</th>
<th align="right">MSE</th>
<th align="right">RMSE</th>
<th align="right">Rel. Bias %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">k_1</td>
<td align="right">0.8</td>
<td align="right">0.8023</td>
<td align="right">0.0023</td>
<td align="right">0.0014</td>
<td align="right">0.0015</td>
<td align="right">0.0381</td>
<td align="right">0.2870</td>
</tr>
<tr class="even">
<td align="left">beta_1</td>
<td align="right">150.0</td>
<td align="right">149.1641</td>
<td align="right">-0.8359</td>
<td align="right">186.8374</td>
<td align="right">187.5362</td>
<td align="right">13.6944</td>
<td align="right">-0.5573</td>
</tr>
<tr class="odd">
<td align="left">k_2</td>
<td align="right">1.5</td>
<td align="right">1.4903</td>
<td align="right">-0.0097</td>
<td align="right">0.0051</td>
<td align="right">0.0052</td>
<td align="right">0.0722</td>
<td align="right">-0.6466</td>
</tr>
<tr class="even">
<td align="left">beta_2</td>
<td align="right">120.0</td>
<td align="right">120.7270</td>
<td align="right">0.7270</td>
<td align="right">31.4111</td>
<td align="right">31.9396</td>
<td align="right">5.6515</td>
<td align="right">0.6058</td>
</tr>
<tr class="odd">
<td align="left">k_3</td>
<td align="right">2.0</td>
<td align="right">1.9947</td>
<td align="right">-0.0053</td>
<td align="right">0.0077</td>
<td align="right">0.0077</td>
<td align="right">0.0877</td>
<td align="right">-0.2631</td>
</tr>
<tr class="even">
<td align="left">beta_3</td>
<td align="right">100.0</td>
<td align="right">100.5773</td>
<td align="right">0.5773</td>
<td align="right">10.3223</td>
<td align="right">10.6556</td>
<td align="right">3.2643</td>
<td align="right">0.5773</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="confidence-interval-coverage">Confidence interval coverage<a class="anchor" aria-label="anchor" href="#confidence-interval-coverage"></a>
</h3>
<p>The asymptotic
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(1 - \alpha)</annotation></semantics></math>%
Wald confidence interval for each parameter is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>θ</mi><mo accent="true">̂</mo></mover><mi>j</mi></msub><mo>±</mo><msub><mi>z</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi><mi>/</mi><mn>2</mn></mrow></msub><mo>⋅</mo><mtext mathvariant="normal">SE</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>θ</mi><mo accent="true">̂</mo></mover><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\hat\theta_j \pm z_{1-\alpha/2} \cdot \text{SE}(\hat\theta_j),
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="normal">SE</mtext><annotation encoding="application/x-tex">\text{SE}</annotation></semantics></math>
is derived from the observed information (negative Hessian).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">m_mc</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">m_mc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">valid_j</span> <span class="op">&lt;-</span> <span class="va">valid</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">ci_lower</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">covered</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">ci_lower</span><span class="op">[</span><span class="va">valid_j</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">theta_mc</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">(</span><span class="va">theta_mc</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">results</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">[</span><span class="va">valid_j</span>, <span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">coverage</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">covered</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mean_width</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">[</span><span class="va">valid</span>, <span class="op">]</span> <span class="op">-</span> <span class="va">results</span><span class="op">$</span><span class="va">ci_lower</span><span class="op">[</span><span class="va">valid</span>, <span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">coverage_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Parameter <span class="op">=</span> <span class="va">par_names_mc</span>,</span>
<span>  True <span class="op">=</span> <span class="va">theta_mc</span>,</span>
<span>  Coverage <span class="op">=</span> <span class="va">coverage</span>,</span>
<span>  Nominal <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span>,</span>
<span>  Mean_Width <span class="op">=</span> <span class="va">mean_width</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">coverage_df</span>, digits <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">)</span>,</span>
<span>                              <span class="st">"% CI coverage (nominal = "</span>,</span>
<span>                              <span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span>, <span class="st">")"</span><span class="op">)</span>,</span>
<span>             col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Parameter"</span>, <span class="st">"True"</span>, <span class="st">"Coverage"</span>,</span>
<span>                          <span class="st">"Nominal"</span>, <span class="st">"Mean Width"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>95% CI coverage (nominal = 0.95)</caption>
<thead><tr class="header">
<th align="left">Parameter</th>
<th align="right">True</th>
<th align="right">Coverage</th>
<th align="right">Nominal</th>
<th align="right">Mean Width</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">k_1</td>
<td align="right">0.8</td>
<td align="right">0.9390</td>
<td align="right">0.95</td>
<td align="right">0.1499</td>
</tr>
<tr class="even">
<td align="left">beta_1</td>
<td align="right">150.0</td>
<td align="right">0.9024</td>
<td align="right">0.95</td>
<td align="right">51.5038</td>
</tr>
<tr class="odd">
<td align="left">k_2</td>
<td align="right">1.5</td>
<td align="right">0.9756</td>
<td align="right">0.95</td>
<td align="right">0.2997</td>
</tr>
<tr class="even">
<td align="left">beta_2</td>
<td align="right">120.0</td>
<td align="right">0.9756</td>
<td align="right">0.95</td>
<td align="right">24.3745</td>
</tr>
<tr class="odd">
<td align="left">k_3</td>
<td align="right">2.0</td>
<td align="right">0.9512</td>
<td align="right">0.95</td>
<td align="right">0.3486</td>
</tr>
<tr class="even">
<td align="left">beta_3</td>
<td align="right">100.0</td>
<td align="right">0.9634</td>
<td align="right">0.95</td>
<td align="right">12.2623</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="sampling-distribution">Sampling distribution<a class="anchor" aria-label="anchor" href="#sampling-distribution"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">m_mc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">est_valid</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="fl">20</span>, probability <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       main <span class="op">=</span> <span class="va">par_names_mc</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>,</span>
<span>       xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="st">"lightblue"</span>, border <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">theta_mc</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">est_valid</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True"</span>, <span class="st">"Mean"</span><span class="op">)</span>,</span>
<span>         col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="weibull_series_files/figure-html/mc-sampling-dist-1.png" class="r-plt" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>The Monte Carlo simulation
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">n = 1000</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mn>82</mn></mrow><annotation encoding="application/x-tex">B = 82</annotation></semantics></math>
converged,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">p = 0.2</annotation></semantics></math>)
demonstrates the following properties of the heterogeneous Weibull
MLE:</p>
<ul>
<li><p><strong>All six parameters are recovered with low bias.</strong>
Relative bias is below 1% for all parameters, confirming the MLE is
approximately unbiased at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">n = 1000</annotation></semantics></math>.
The 2m-parameter model is identifiable despite doubling the parameter
count relative to the homogeneous model.</p></li>
<li><p><strong>Shape parameters have similar relative precision across
regimes.</strong> The DFR shape
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mn>1</mn></msub><mo>=</mo><mn>0.8</mn></mrow><annotation encoding="application/x-tex">k_1 = 0.8</annotation></semantics></math>,
RMSE = 0.038) and IFR shape
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mn>3</mn></msub><mo>=</mo><mn>2.0</mn></mrow><annotation encoding="application/x-tex">k_3 = 2.0</annotation></semantics></math>,
RMSE = 0.088) have comparable relative RMSE
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">\sim 4</annotation></semantics></math>–<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">5\%</annotation></semantics></math>).
In absolute terms, larger shapes are harder to pin down, but the
relative difficulty is roughly constant.</p></li>
<li><p><strong>Scale RMSE scales with the true value.</strong> Component
1
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mn>1</mn></msub><mo>=</mo><mn>150</mn></mrow><annotation encoding="application/x-tex">\beta_1 = 150</annotation></semantics></math>,
RMSE
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>14</mn></mrow><annotation encoding="application/x-tex">\approx 14</annotation></semantics></math>)
has roughly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>×</mo></mrow><annotation encoding="application/x-tex">4\times</annotation></semantics></math>
the RMSE of Component 3
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mn>3</mn></msub><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">\beta_3 = 100</annotation></semantics></math>,
RMSE
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\approx 3</annotation></semantics></math>),
consistent with RMSE being approximately proportional to the parameter
magnitude.</p></li>
<li><p><strong>Coverage is near nominal for most parameters.</strong>
Most Wald intervals achieve 94–98% coverage. The exception is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\beta_1</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo><mn>90</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">\sim 90\%</annotation></semantics></math>),
which shows slight undercoverage — the large-scale DFR component is the
hardest to estimate precisely.</p></li>
<li><p><strong>L-BFGS-B with positivity bounds is essential.</strong>
Using bounded optimization achieves
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo><mn>82</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">\sim 82\%</annotation></semantics></math>
convergence compared to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>10</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">&lt; 10\%</annotation></semantics></math>
with unconstrained Nelder-Mead. The positivity constraints
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>j</mi></msub><mo>,</mo><msub><mi>β</mi><mi>j</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k_j, \beta_j &gt; 0</annotation></semantics></math>)
are natural for this problem and dramatically improve numerical
stability.</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alexander Towell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
